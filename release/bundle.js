!function(){"use strict";function e(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function s(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){e.done?o(e.value):new r(function(t){t(e.value)}).then(a,s)}u((n=n.apply(e,t||[])).next())})}let t=Float32Array;function r(e,r,n){const o=new t(3);return e&&(o[0]=e),r&&(o[1]=r),n&&(o[2]=n),o}function n(e,r,n){return(n=n||new t(3))[0]=e[0]+r[0],n[1]=e[1]+r[1],n[2]=e[2]+r[2],n}function o(e,r,n){return(n=n||new t(3))[0]=e[0]*r,n[1]=e[1]*r,n[2]=e[2]*r,n}function i(e,r,n){n=n||new t(3);const o=e[2]*r[0]-e[0]*r[2],i=e[0]*r[1]-e[1]*r[0];return n[0]=e[1]*r[2]-e[2]*r[1],n[1]=o,n[2]=i,n}function a(e,r){r=r||new t(3);const n=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],o=Math.sqrt(n);return o>1e-5?(r[0]=e[0]/o,r[1]=e[1]/o,r[2]=e[2]/o):(r[0]=0,r[1]=0,r[2]=0),r}let s=Float32Array;const u=r(),l=r(),c=r();function f(e,t){if((t=t||new s(16))===e){let r;return r=e[1],e[1]=e[4],e[4]=r,r=e[2],e[2]=e[8],e[8]=r,r=e[3],e[3]=e[12],e[12]=r,r=e[6],e[6]=e[9],e[9]=r,r=e[7],e[7]=e[13],e[13]=r,r=e[11],e[11]=e[14],e[14]=r,t}const r=e[0],n=e[1],o=e[2],i=e[3],a=e[4],u=e[5],l=e[6],c=e[7],f=e[8],m=e[9],d=e[10],p=e[11],E=e[12],b=e[13],y=e[14],h=e[15];return t[0]=r,t[1]=a,t[2]=f,t[3]=E,t[4]=n,t[5]=u,t[6]=m,t[7]=b,t[8]=o,t[9]=l,t[10]=d,t[11]=y,t[12]=i,t[13]=c,t[14]=p,t[15]=h,t}function m(e,t){t=t||new s(16);const r=e[0],n=e[1],o=e[2],i=e[3],a=e[4],u=e[5],l=e[6],c=e[7],f=e[8],m=e[9],d=e[10],p=e[11],E=e[12],b=e[13],y=e[14],h=e[15],_=d*h,T=y*p,A=l*h,R=y*c,g=l*p,x=d*c,v=o*h,F=y*i,P=o*p,w=d*i,U=o*c,S=l*i,I=f*b,B=E*m,L=a*b,M=E*u,C=a*m,N=f*u,k=r*b,O=E*n,D=r*m,G=f*n,z=r*u,X=a*n,W=_*u+R*m+g*b-(T*u+A*m+x*b),Y=T*n+v*m+w*b-(_*n+F*m+P*b),K=A*n+F*u+U*b-(R*n+v*u+S*b),H=x*n+P*u+S*m-(g*n+w*u+U*m),V=1/(r*W+a*Y+f*K+E*H);return t[0]=V*W,t[1]=V*Y,t[2]=V*K,t[3]=V*H,t[4]=V*(T*a+A*f+x*E-(_*a+R*f+g*E)),t[5]=V*(_*r+F*f+P*E-(T*r+v*f+w*E)),t[6]=V*(R*r+v*a+S*E-(A*r+F*a+U*E)),t[7]=V*(g*r+w*a+U*f-(x*r+P*a+S*f)),t[8]=V*(I*c+M*p+C*h-(B*c+L*p+N*h)),t[9]=V*(B*i+k*p+G*h-(I*i+O*p+D*h)),t[10]=V*(L*i+O*c+z*h-(M*i+k*c+X*h)),t[11]=V*(N*i+D*c+X*p-(C*i+G*c+z*p)),t[12]=V*(L*d+N*y+B*l-(C*y+I*l+M*d)),t[13]=V*(D*y+I*o+O*d-(k*d+G*y+B*o)),t[14]=V*(k*l+X*y+M*o-(z*y+L*o+O*l)),t[15]=V*(z*d+C*o+G*l-(D*l+X*d+N*o)),t}function d(e,t,r){r=r||new s(16);const n=e[0],o=e[1],i=e[2],a=e[3],u=e[4],l=e[5],c=e[6],f=e[7],m=e[8],d=e[9],p=e[10],E=e[11],b=e[12],y=e[13],h=e[14],_=e[15],T=t[0],A=t[1],R=t[2],g=t[3],x=t[4],v=t[5],F=t[6],P=t[7],w=t[8],U=t[9],S=t[10],I=t[11],B=t[12],L=t[13],M=t[14],C=t[15];return r[0]=n*T+u*A+m*R+b*g,r[1]=o*T+l*A+d*R+y*g,r[2]=i*T+c*A+p*R+h*g,r[3]=a*T+f*A+E*R+_*g,r[4]=n*x+u*v+m*F+b*P,r[5]=o*x+l*v+d*F+y*P,r[6]=i*x+c*v+p*F+h*P,r[7]=a*x+f*v+E*F+_*P,r[8]=n*w+u*U+m*S+b*I,r[9]=o*w+l*U+d*S+y*I,r[10]=i*w+c*U+p*S+h*I,r[11]=a*w+f*U+E*S+_*I,r[12]=n*B+u*L+m*M+b*C,r[13]=o*B+l*L+d*M+y*C,r[14]=i*B+c*L+p*M+h*C,r[15]=a*B+f*L+E*M+_*C,r}function p(e,r,n,o){o=o||new s(16);const f=u,m=l,d=c;return a(function(e,r,n){return(n=n||new t(3))[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],n}(e,r,d),d),a(i(n,d,f),f),a(i(d,f,m),m),o[0]=f[0],o[1]=f[1],o[2]=f[2],o[3]=0,o[4]=m[0],o[5]=m[1],o[6]=m[2],o[7]=0,o[8]=d[0],o[9]=d[1],o[10]=d[2],o[11]=0,o[12]=e[0],o[13]=e[1],o[14]=e[2],o[15]=1,o}const E=5120,b=5121,y=5122,h=5123,_=5124,T=5125,A=5126,R={};{const e=R;e[E]=Int8Array,e[b]=Uint8Array,e[y]=Int16Array,e[h]=Uint16Array,e[_]=Int32Array,e[T]=Uint32Array,e[A]=Float32Array,e[32819]=Uint16Array,e[32820]=Uint16Array,e[33635]=Uint16Array,e[5131]=Uint16Array,e[33640]=Uint32Array,e[35899]=Uint32Array,e[35902]=Uint32Array,e[36269]=Uint32Array,e[34042]=Uint32Array}function g(e){if(e instanceof Int8Array)return E;if(e instanceof Uint8Array)return b;if(e instanceof Uint8ClampedArray)return b;if(e instanceof Int16Array)return y;if(e instanceof Uint16Array)return h;if(e instanceof Int32Array)return _;if(e instanceof Uint32Array)return T;if(e instanceof Float32Array)return A;throw new Error("unsupported typed array type")}const x="undefined"!=typeof SharedArrayBuffer?function(e){return e&&e.buffer&&(e.buffer instanceof ArrayBuffer||e.buffer instanceof SharedArrayBuffer)}:function(e){return e&&e.buffer&&e.buffer instanceof ArrayBuffer},v="undefined"!=typeof console&&console.error&&"function"==typeof console.error?console.error.bind(console):function(){},F="undefined"!=typeof console&&console.warn&&"function"==typeof console.warn?console.warn.bind(console):function(){};function P(e,t){return"undefined"!=typeof WebGLTexture&&t instanceof WebGLTexture}const w={attribPrefix:""};function U(e,t,r,n){if(o=t,"undefined"!=typeof WebGLBuffer&&o instanceof WebGLBuffer)return t;var o;r=r||e.ARRAY_BUFFER;const i=e.createBuffer();return function(e,t,r,n,o){e.bindBuffer(t,r),e.bufferData(t,n,o||e.STATIC_DRAW)}(e,r,i,t,n),i}function S(e){return"indices"===e}const I=/coord|texture/i,B=/color|colour/i;function L(e,t){let r;if(t%(r=I.test(e)?2:B.test(e)?4:3)>0)throw new Error(`Can not guess numComponents for attribute '${e}'. Tried ${r} but ${t} values is not evenly divisible by ${r}. You should specify it.`);return r}function M(e,t){if(x(e))return e;if(x(e.data))return e.data;Array.isArray(e)&&(e={data:e});let r=e.type;return r||(r=S(t)?Uint16Array:Float32Array),new r(e.data)}function C(e,t){const r={};return Object.keys(t).forEach(function(n){if(!S(n)){const i=t[n],a=i.attrib||i.name||i.attribName||w.attribPrefix+n;if(i.value){if(!Array.isArray(i.value)&&!x(i.value))throw new Error("array.value is not array or typedarray");r[a]={value:i.value}}else{let t,s,u,l;if(i.buffer&&i.buffer instanceof WebGLBuffer)t=i.buffer,l=i.numComponents||i.size,s=i.type,u=i.normalize;else if("number"==typeof i||"number"==typeof i.data){const r=i.data||i,a=i.type||Float32Array,c=r*a.BYTES_PER_ELEMENT;s=function(e){if(e===Int8Array)return E;if(e===Uint8Array)return b;if(e===Uint8ClampedArray)return b;if(e===Int16Array)return y;if(e===Uint16Array)return h;if(e===Int32Array)return _;if(e===Uint32Array)return T;if(e===Float32Array)return A;throw new Error("unsupported typed array type")}(a),u=void 0!==i.normalize?i.normalize:(o=a)===Int8Array||o===Uint8Array,l=i.numComponents||i.size||L(n,r),t=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,t),e.bufferData(e.ARRAY_BUFFER,c,i.drawType||e.STATIC_DRAW)}else{const r=M(i,n);t=U(e,r,void 0,i.drawType),s=g(r),u=void 0!==i.normalize?i.normalize:function(e){return e instanceof Int8Array||e instanceof Uint8Array}(r),l=function(e,t){return e.numComponents||e.size||L(t,function(e){return e.length?e:e.data}(e).length)}(i,n)}r[a]={buffer:t,numComponents:l,type:s,normalize:u,stride:i.stride||0,offset:i.offset||0,divisor:void 0===i.divisor?void 0:i.divisor,drawType:i.drawType}}}var o}),e.bindBuffer(e.ARRAY_BUFFER,null),r}const N=["position","positions","a_position"];function k(e,t,r){const n=C(e,t),o=Object.assign({},r||{});o.attribs=Object.assign({},r?r.attribs:{},n);const i=t.indices;if(i){const t=M(i,"indices");o.indices=U(e,t,e.ELEMENT_ARRAY_BUFFER),o.numElements=t.length,o.elementType=g(t)}else o.numElements||(o.numElements=function(e,t){let r,n;for(n=0;n<N.length&&!((r=N[n])in t)&&!((r=w.attribPrefix+r)in t);++n);n===N.length&&(r=Object.keys(t)[0]);const o=t[r];e.bindBuffer(e.ARRAY_BUFFER,o.buffer);const i=e.getBufferParameter(e.ARRAY_BUFFER,e.BUFFER_SIZE);e.bindBuffer(e.ARRAY_BUFFER,null);const a=i/function(e,t){return t===e.BYTE?1:t===e.UNSIGNED_BYTE?1:t===e.SHORT?2:t===e.UNSIGNED_SHORT?2:t===e.INT?4:t===e.UNSIGNED_INT?4:t===e.FLOAT?4:0}(e,o.type),s=o.numComponents||o.size,u=a/s;if(u%1!=0)throw new Error(`numComponents ${s} not correct for length ${length}`);return u}(e,o.attribs));return o}function O(e){return!!e.texStorage2D}const D=function(){const e={},t={};return function(r,n){return function(r){const n=r.constructor.name;if(!e[n]){for(const e in r)if("number"==typeof r[e]){const n=t[r[e]];t[r[e]]=n?`${n} | ${e}`:e}e[n]=!0}}(r),t[n]||"0x"+n.toString(16)}}(),G={textureColor:new Uint8Array([128,192,255,255]),textureOptions:{},crossOrigin:void 0},z=x,X="undefined"!=typeof document&&document.createElement?document.createElement("canvas").getContext("2d"):null,W=6407,Y=33319,K={};{const e=K;e[6406]={textureFormat:6406,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[1,2,2,4],type:[5121,5131,36193,5126]},e[6409]={textureFormat:6409,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[1,2,2,4],type:[5121,5131,36193,5126]},e[6410]={textureFormat:6410,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[2,4,4,8],type:[5121,5131,36193,5126]},e[W]={textureFormat:W,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[3,6,6,12,2],type:[5121,5131,36193,5126,33635]},e[6408]={textureFormat:6408,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4,8,8,16,2,2],type:[5121,5131,36193,5126,32819,32820]},e[33321]={textureFormat:6403,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[1],type:[5121]},e[36756]={textureFormat:6403,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[1],type:[5120]},e[33325]={textureFormat:6403,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[4,2],type:[5126,5131]},e[33326]={textureFormat:6403,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[4],type:[5126]},e[33330]={textureFormat:36244,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[1],type:[5121]},e[33329]={textureFormat:36244,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[1],type:[5120]},e[33332]={textureFormat:36244,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[5123]},e[33331]={textureFormat:36244,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[5122]},e[33334]={textureFormat:36244,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[5125]},e[33333]={textureFormat:36244,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[5124]},e[33323]={textureFormat:Y,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[2],type:[5121]},e[36757]={textureFormat:Y,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[2],type:[5120]},e[33327]={textureFormat:Y,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[8,4],type:[5126,5131]},e[33328]={textureFormat:Y,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[8],type:[5126]},e[33336]={textureFormat:33320,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[5121]},e[33335]={textureFormat:33320,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[5120]},e[33338]={textureFormat:33320,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[5123]},e[33337]={textureFormat:33320,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[5122]},e[33340]={textureFormat:33320,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[5125]},e[33339]={textureFormat:33320,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[5124]},e[32849]={textureFormat:W,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[3],type:[5121]},e[35905]={textureFormat:W,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[3],type:[5121]},e[36194]={textureFormat:W,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[3,2],type:[5121,33635]},e[36758]={textureFormat:W,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[3],type:[5120]},e[35898]={textureFormat:W,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[12,6,4],type:[5126,5131,35899]},e[35901]={textureFormat:W,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[12,6,4],type:[5126,5131,35902]},e[34843]={textureFormat:W,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[12,6],type:[5126,5131]},e[34837]={textureFormat:W,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[12],type:[5126]},e[36221]={textureFormat:36248,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[3],type:[5121]},e[36239]={textureFormat:36248,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[3],type:[5120]},e[36215]={textureFormat:36248,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[6],type:[5123]},e[36233]={textureFormat:36248,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[6],type:[5122]},e[36209]={textureFormat:36248,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[12],type:[5125]},e[36227]={textureFormat:36248,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[12],type:[5124]},e[32856]={textureFormat:6408,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4],type:[5121]},e[35907]={textureFormat:6408,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4],type:[5121]},e[36759]={textureFormat:6408,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[4],type:[5120]},e[32855]={textureFormat:6408,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4,2,4],type:[5121,32820,33640]},e[32854]={textureFormat:6408,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4,2],type:[5121,32819]},e[32857]={textureFormat:6408,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4],type:[33640]},e[34842]={textureFormat:6408,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[16,8],type:[5126,5131]},e[34836]={textureFormat:6408,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[16],type:[5126]},e[36220]={textureFormat:36249,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[5121]},e[36238]={textureFormat:36249,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[5120]},e[36975]={textureFormat:36249,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[33640]},e[36214]={textureFormat:36249,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[5123]},e[36232]={textureFormat:36249,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[5122]},e[36226]={textureFormat:36249,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[16],type:[5124]},e[36208]={textureFormat:36249,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[16],type:[5125]},e[33189]={textureFormat:6402,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2,4],type:[5123,5125]},e[33190]={textureFormat:6402,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[5125]},e[36012]={textureFormat:6402,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[5126]},e[35056]={textureFormat:34041,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[34042]},e[36013]={textureFormat:34041,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[36269]},Object.keys(e).forEach(function(t){const r=e[t];r.bytesPerElementMap={},r.bytesPerElement.forEach(function(e,t){const n=r.type[t];r.bytesPerElementMap[n]=e})})}function H(e){const t=K[e];if(!t)throw"unknown internal format";return{format:t.textureFormat,type:t.type[0]}}function V(e){return 0==(e&e-1)}function $(e,t,r,n,o){if(o%1!=0)throw"can't guess dimensions";if(r||n){if(n){if(!r&&(r=o/n)%1)throw"can't guess dimensions"}else if((n=o/r)%1)throw"can't guess dimensions"}else{const i=Math.sqrt(o/(t===e.TEXTURE_CUBE_MAP?6:1));i%1==0?(r=i,n=i):(r=o,n=1)}return{width:r,height:n}}const j={};function q(e,t){void 0!==t.colorspaceConversion&&(j.colorspaceConversion=e.getParameter(e.UNPACK_COLORSPACE_CONVERSION_WEBGL),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.colorspaceConversion)),void 0!==t.premultiplyAlpha&&(j.premultiplyAlpha=e.getParameter(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha)),void 0!==t.flipY&&(j.flipY=e.getParameter(e.UNPACK_FLIP_Y_WEBGL),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t.flipY))}function J(e,t){void 0!==t.colorspaceConversion&&e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,j.colorspaceConversion),void 0!==t.premultiplyAlpha&&e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,j.premultiplyAlpha),void 0!==t.flipY&&e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,j.flipY)}function Z(e){j.unpackAlignment=e.getParameter(e.UNPACK_ALIGNMENT),O(e)&&(j.unpackRowLength=e.getParameter(e.UNPACK_ROW_LENGTH),j.unpackImageHeight=e.getParameter(e.UNPACK_IMAGE_HEIGHT),j.unpackSkipPixels=e.getParameter(e.UNPACK_SKIP_PIXELS),j.unpackSkipRows=e.getParameter(e.UNPACK_SKIP_ROWS),j.unpackSkipImages=e.getParameter(e.UNPACK_SKIP_IMAGES))}function Q(e){e.pixelStorei(e.UNPACK_ALIGNMENT,j.unpackAlignment),O(e)&&(e.pixelStorei(e.UNPACK_ROW_LENGTH,j.unpackRowLength),e.pixelStorei(e.UNPACK_IMAGE_HEIGHT,j.unpackImageHeight),e.pixelStorei(e.UNPACK_SKIP_PIXELS,j.unpackSkipPixels),e.pixelStorei(e.UNPACK_SKIP_ROWS,j.unpackSkipRows),e.pixelStorei(e.UNPACK_SKIP_IMAGES,j.unpackSkipImages))}function ee(e,t,r,n){var o;n.minMag&&(r.call(e,t,e.TEXTURE_MIN_FILTER,n.minMag),r.call(e,t,e.TEXTURE_MAG_FILTER,n.minMag)),n.min&&r.call(e,t,e.TEXTURE_MIN_FILTER,n.min),n.mag&&r.call(e,t,e.TEXTURE_MAG_FILTER,n.mag),n.wrap&&(r.call(e,t,e.TEXTURE_WRAP_S,n.wrap),r.call(e,t,e.TEXTURE_WRAP_T,n.wrap),(t===e.TEXTURE_3D||(o=t,"undefined"!=typeof WebGLSampler&&o instanceof WebGLSampler))&&r.call(e,t,e.TEXTURE_WRAP_R,n.wrap)),n.wrapR&&r.call(e,t,e.TEXTURE_WRAP_R,n.wrapR),n.wrapS&&r.call(e,t,e.TEXTURE_WRAP_S,n.wrapS),n.wrapT&&r.call(e,t,e.TEXTURE_WRAP_T,n.wrapT),n.minLod&&r.call(e,t,e.TEXTURE_MIN_LOD,n.minLod),n.maxLod&&r.call(e,t,e.TEXTURE_MAX_LOD,n.maxLod),n.baseLevel&&r.call(e,t,e.TEXTURE_BASE_LEVEL,n.baseLevel),n.maxLevel&&r.call(e,t,e.TEXTURE_MAX_LEVEL,n.maxLevel)}function te(e,t,r){const n=r.target||e.TEXTURE_2D;e.bindTexture(n,t),ee(e,n,e.texParameteri,r)}function re(e,t,r,n,o,i,a){r=r||G.textureOptions,i=i||e.RGBA,a=a||e.UNSIGNED_BYTE;const s=r.target||e.TEXTURE_2D;if(n=n||r.width,o=o||r.height,e.bindTexture(s,t),function(e,t,r,n){if(!O(e))return V(t)&&V(r);const o=K[n];if(!o)throw"unknown internal format";return o.colorRenderable&&o.textureFilterable}(e,n,o,i))e.generateMipmap(s);else{const t=function(e){const t=K[e];if(!t)throw"unknown internal format";return t.textureFilterable}(i)?e.LINEAR:e.NEAREST;e.texParameteri(s,e.TEXTURE_MIN_FILTER,t),e.texParameteri(s,e.TEXTURE_MAG_FILTER,t),e.texParameteri(s,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(s,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)}}function ne(e){return!0===e.auto||void 0===e.auto&&void 0===e.level}function oe(e,t){return(t=t||{}).cubeFaceOrder||[e.TEXTURE_CUBE_MAP_POSITIVE_X,e.TEXTURE_CUBE_MAP_NEGATIVE_X,e.TEXTURE_CUBE_MAP_POSITIVE_Y,e.TEXTURE_CUBE_MAP_NEGATIVE_Y,e.TEXTURE_CUBE_MAP_POSITIVE_Z,e.TEXTURE_CUBE_MAP_NEGATIVE_Z]}function ie(e,t){const r=oe(e,t).map(function(e,t){return{face:e,ndx:t}});return r.sort(function(e,t){return e.face-t.face}),r}function ae(e,t,r,n){const o=(n=n||G.textureOptions).target||e.TEXTURE_2D,i=n.level||0;let a=r.width,s=r.height;const u=n.internalFormat||n.format||e.RGBA,l=H(u),c=n.format||l.format,f=n.type||l.type;if(q(e,n),e.bindTexture(o,t),o===e.TEXTURE_CUBE_MAP){const l=r.width,m=r.height;let d,p;if(l/6===m)d=m,p=[0,0,1,0,2,0,3,0,4,0,5,0];else if(m/6===l)d=l,p=[0,0,0,1,0,2,0,3,0,4,0,5];else if(l/3==m/2)d=l/3,p=[0,0,1,0,2,0,0,1,1,1,2,1];else{if(l/2!=m/3)throw"can't figure out cube map from element: "+(r.src?r.src:r.nodeName);d=l/2,p=[0,0,1,0,0,1,1,1,0,2,1,2]}X?(X.canvas.width=d,X.canvas.height=d,a=d,s=d,ie(e,n).forEach(function(t){const n=p[2*t.ndx+0]*d,o=p[2*t.ndx+1]*d;X.drawImage(r,n,o,d,d,0,0,d,d),e.texImage2D(t.face,i,u,c,f,X.canvas)}),X.canvas.width=1,X.canvas.height=1):"undefined"!=typeof createImageBitmap&&(a=d,s=d,ie(e,n).forEach(function(l){const m=p[2*l.ndx+0]*d,E=p[2*l.ndx+1]*d;e.texImage2D(l.face,i,u,d,d,0,c,f,null),createImageBitmap(r,m,E,d,d,{premultiplyAlpha:"none",colorSpaceConversion:"none"}).then(function(r){q(e,n),e.bindTexture(o,t),e.texImage2D(l.face,i,u,c,f,r),J(e,n),ne(n)&&re(e,t,n,a,s,u,f)})}))}else if(o===e.TEXTURE_3D||o===e.TEXTURE_2D_ARRAY){const t=Math.min(r.width,r.height),n=Math.max(r.width,r.height),a=n/t;if(a%1!=0)throw"can not compute 3D dimensions of element";const s=r.width===n?1:0,l=r.height===n?1:0;Z(e),e.pixelStorei(e.UNPACK_ALIGNMENT,1),e.pixelStorei(e.UNPACK_ROW_LENGTH,r.width),e.pixelStorei(e.UNPACK_IMAGE_HEIGHT,0),e.pixelStorei(e.UNPACK_SKIP_IMAGES,0),e.texImage3D(o,i,u,t,t,t,0,c,f,null);for(let n=0;n<a;++n){const a=n*t*s,u=n*t*l;e.pixelStorei(e.UNPACK_SKIP_PIXELS,a),e.pixelStorei(e.UNPACK_SKIP_ROWS,u),e.texSubImage3D(o,i,0,0,n,t,t,1,c,f,r)}Q(e)}else e.texImage2D(o,i,u,c,f,r);J(e,n),ne(n)&&re(e,t,n,a,s,u,f),te(e,t,n)}function se(){}function ue(e,t){return void 0!==t||function(e){if("undefined"!=typeof document){const t=document.createElement("a");return t.href=e,t.hostname===location.hostname&&t.port===location.port&&t.protocol===location.protocol}{const t=new URL(location.href).origin;return new URL(e,location.href).origin===t}}(e)?t:"anonymous"}function le(e){return"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof ImageData&&e instanceof ImageData||"undefined"!=typeof HTMLElement&&e instanceof HTMLElement}function ce(e,t,r){return le(e)?(setTimeout(function(){r(null,e)}),e):function(e,t,r){let n;if(r=r||se,t=void 0!==t?t:G.crossOrigin,t=ue(e,t),"undefined"!=typeof Image){n=new Image,void 0!==t&&(n.crossOrigin=t);const o=function(){n.removeEventListener("error",i),n.removeEventListener("load",a),n=null},i=function(){const t="couldn't load image: "+e;v(t),r(t,n),o()},a=function(){r(null,n),o()};return n.addEventListener("error",i),n.addEventListener("load",a),n.src=e,n}if("undefined"!=typeof ImageBitmap){let o,i;const a=function(){r(o,i)},s={};t&&(s.mode="cors"),fetch(e,s).then(function(e){if(!e.ok)throw e;return e.blob()}).then(function(e){return createImageBitmap(e,{premultiplyAlpha:"none",colorSpaceConversion:"none"})}).then(function(e){i=e,setTimeout(a)}).catch(function(e){o=e,setTimeout(a)}),n=null}return n}(e,t,r)}function fe(e,t,r){const n=(r=r||G.textureOptions).target||e.TEXTURE_2D;if(e.bindTexture(n,t),!1===r.color)return;const o=function(e){return e=e||G.textureColor,z(e)?e:new Uint8Array([255*e[0],255*e[1],255*e[2],255*e[3]])}(r.color);if(n===e.TEXTURE_CUBE_MAP)for(let t=0;t<6;++t)e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,o);else n===e.TEXTURE_3D||n===e.TEXTURE_2D_ARRAY?e.texImage3D(n,0,e.RGBA,1,1,1,0,e.RGBA,e.UNSIGNED_BYTE,o):e.texImage2D(n,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,o)}function me(e,t,r,n){n=n||se;const o=r.src;if(6!==o.length)throw"there must be 6 urls for a cubemap";const i=r.level||0,a=r.internalFormat||r.format||e.RGBA,s=H(a),u=r.format||s.format,l=r.type||e.UNSIGNED_BYTE,c=r.target||e.TEXTURE_2D;if(c!==e.TEXTURE_CUBE_MAP)throw"target must be TEXTURE_CUBE_MAP";fe(e,t,r),r=Object.assign({},r);let f=6;const m=[],d=oe(e,r);let p;p=o.map(function(o,s){return ce(o,r.crossOrigin,(E=d[s],function(o,s){--f,o?m.push(o):s.width!==s.height?m.push("cubemap face img is not a square: "+s.src):(q(e,r),e.bindTexture(c,t),5===f?oe(e).forEach(function(t){e.texImage2D(t,i,a,u,l,s)}):e.texImage2D(E,i,a,u,l,s),J(e,r),ne(r)&&e.generateMipmap(c)),0===f&&n(m.length?m:void 0,t,p)}));var E})}function de(e,t,r,n){n=n||se;const o=r.src,i=r.internalFormat||r.format||e.RGBA,a=H(i),s=r.format||a.format,u=r.type||e.UNSIGNED_BYTE,l=r.target||e.TEXTURE_2D_ARRAY;if(l!==e.TEXTURE_3D&&l!==e.TEXTURE_2D_ARRAY)throw"target must be TEXTURE_3D or TEXTURE_2D_ARRAY";fe(e,t,r),r=Object.assign({},r);let c=o.length;const f=[];let m;const d=r.level||0;let p=r.width,E=r.height;const b=o.length;let y=!0;m=o.map(function(o,a){return ce(o,r.crossOrigin,(h=a,function(o,a){if(--c,o)f.push(o);else{if(q(e,r),e.bindTexture(l,t),y){y=!1,p=r.width||a.width,E=r.height||a.height,e.texImage3D(l,d,i,p,E,b,0,s,u,null);for(let t=0;t<b;++t)e.texSubImage3D(l,d,0,0,t,p,E,1,s,u,a)}else{let t=a;a.width===p&&a.height===E||(t=X.canvas,X.canvas.width=p,X.canvas.height=E,X.drawImage(a,0,0,p,E)),e.texSubImage3D(l,d,0,0,h,p,E,1,s,u,t),t===X.canvas&&(X.canvas.width=0,X.canvas.height=0)}J(e,r),ne(r)&&e.generateMipmap(l)}0===c&&n(f.length?f:void 0,t,m)}));var h})}function pe(e,t,r,n){const o=(n=n||G.textureOptions).target||e.TEXTURE_2D;e.bindTexture(o,t);let i=n.width,a=n.height,s=n.depth;const u=n.level||0,l=n.internalFormat||n.format||e.RGBA,c=H(l),f=n.format||c.format,m=n.type||function(e,t,r){return z(t)?g(t):r||e.UNSIGNED_BYTE}(e,r,c.type);if(z(r))r instanceof Uint8ClampedArray&&(r=new Uint8Array(r.buffer));else{const e=function(e){const t=R[e];if(!t)throw new Error("unknown gl type");return t}(m);r=new e(r)}const d=function(e,t){const r=K[e];if(!r)throw"unknown internal format";const n=r.bytesPerElementMap[t];if(void 0===n)throw"unknown internal format";return n}(l,m),p=r.byteLength/d;if(p%1)throw"length wrong size for format: "+D(e,f);let E;if(o===e.TEXTURE_3D)if(i||a||s)!i||a&&s?!a||i&&s?(E=$(e,o,i,a,p/s),i=E.width,a=E.height):(E=$(e,o,i,s,p/a),i=E.width,s=E.height):(E=$(e,o,a,s,p/i),a=E.width,s=E.height);else{const e=Math.cbrt(p);if(e%1!=0)throw"can't guess cube size of array of numElements: "+p;i=e,a=e,s=e}else E=$(e,o,i,a,p),i=E.width,a=E.height;if(Z(e),e.pixelStorei(e.UNPACK_ALIGNMENT,n.unpackAlignment||1),q(e,n),o===e.TEXTURE_CUBE_MAP){const t=p/6*(d/r.BYTES_PER_ELEMENT);ie(e,n).forEach(n=>{const o=t*n.ndx,s=r.subarray(o,o+t);e.texImage2D(n.face,u,l,i,a,0,f,m,s)})}else o===e.TEXTURE_3D?e.texImage3D(o,u,l,i,a,s,0,f,m,r):e.texImage2D(o,u,l,i,a,0,f,m,r);return J(e,n),Q(e),{width:i,height:a,depth:s,type:m}}function Ee(e,t,r){r=r||se,t=t||G.textureOptions;const n=e.createTexture(),o=t.target||e.TEXTURE_2D;let i=t.width||1,a=t.height||1;const s=t.internalFormat||e.RGBA,u=H(s);let l=t.type||u.type;e.bindTexture(o,n),o===e.TEXTURE_CUBE_MAP&&(e.texParameteri(o,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(o,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE));let c=t.src;if(c)if("function"==typeof c&&(c=c(e,t)),"string"==typeof c)!function(e,t,r,n){n=n||se,r=r||G.textureOptions,fe(e,t,r),ce((r=Object.assign({},r)).src,r.crossOrigin,function(o,i){o?n(o,t,i):(ae(e,t,i,r),n(null,t,i))})}(e,n,t,r);else if(z(c)||Array.isArray(c)&&("number"==typeof c[0]||Array.isArray(c[0])||z(c[0]))){const r=pe(e,n,c,t);i=r.width,a=r.height,l=r.type}else if(Array.isArray(c)&&("string"==typeof c[0]||le(c[0])))o===e.TEXTURE_CUBE_MAP?me(e,n,t,r):de(e,n,t,r);else{if(!le(c))throw"unsupported src type";ae(e,n,c,t),i=c.width,a=c.height}else!function(e,t,r){const n=r.target||e.TEXTURE_2D;e.bindTexture(n,t);const o=r.level||0,i=r.internalFormat||r.format||e.RGBA,a=H(i),s=r.format||a.format,u=r.type||a.type;if(q(e,r),n===e.TEXTURE_CUBE_MAP)for(let t=0;t<6;++t)e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,o,i,r.width,r.height,0,s,u,null);else n===e.TEXTURE_3D?e.texImage3D(n,o,i,r.width,r.height,r.depth,0,s,u,null):e.texImage2D(n,o,i,r.width,r.height,0,s,u,null);J(e,r)}(e,n,t);return ne(t)&&re(e,n,t,i,a,s,l),te(e,n,t),n}const be=v,ye="undefined"!=typeof document&&document.getElementById?document.getElementById.bind(document):function(){return null},he={};function _e(e,t){return he[t].bindPoint}function Te(e,t){return function(r){e.uniform1i(t,r)}}function Ae(e,t){return function(r){e.uniform1iv(t,r)}}function Re(e,t){return function(r){e.uniform2iv(t,r)}}function ge(e,t){return function(r){e.uniform3iv(t,r)}}function xe(e,t){return function(r){e.uniform4iv(t,r)}}function ve(e,t,r,n){const o=_e(0,t);return O(e)?function(t){let i,a;P(0,t)?(i=t,a=null):(i=t.texture,a=t.sampler),e.uniform1i(n,r),e.activeTexture(e.TEXTURE0+r),e.bindTexture(o,i),e.bindSampler(r,a)}:function(t){e.uniform1i(n,r),e.activeTexture(e.TEXTURE0+r),e.bindTexture(o,t)}}function Fe(e,t,r,n,o){const i=_e(0,t),a=new Int32Array(o);for(let e=0;e<o;++e)a[e]=r+e;return O(e)?function(t){e.uniform1iv(n,a),t.forEach(function(t,n){let o,s;e.activeTexture(e.TEXTURE0+a[n]),P(0,t)?(o=t,s=null):(o=t.texture,s=t.sampler),e.bindSampler(r,s),e.bindTexture(i,o)})}:function(t){e.uniform1iv(n,a),t.forEach(function(t,r){e.activeTexture(e.TEXTURE0+a[r]),e.bindTexture(i,t)})}}function Pe(e,t){return function(r){if(r.value)switch(e.disableVertexAttribArray(t),r.value.length){case 4:e.vertexAttrib4fv(t,r.value);break;case 3:e.vertexAttrib3fv(t,r.value);break;case 2:e.vertexAttrib2fv(t,r.value);break;case 1:e.vertexAttrib1fv(t,r.value);break;default:throw new Error("the length of a float constant value must be between 1 and 4!")}else e.bindBuffer(e.ARRAY_BUFFER,r.buffer),e.enableVertexAttribArray(t),e.vertexAttribPointer(t,r.numComponents||r.size,r.type||e.FLOAT,r.normalize||!1,r.stride||0,r.offset||0),void 0!==r.divisor&&e.vertexAttribDivisor(t,r.divisor)}}function we(e,t){return function(r){if(r.value){if(e.disableVertexAttribArray(t),4!==r.value.length)throw new Error("The length of an integer constant value must be 4!");e.vertexAttrib4iv(t,r.value)}else e.bindBuffer(e.ARRAY_BUFFER,r.buffer),e.enableVertexAttribArray(t),e.vertexAttribIPointer(t,r.numComponents||r.size,r.type||e.INT,r.stride||0,r.offset||0),void 0!==r.divisor&&e.vertexAttribDivisor(t,r.divisor)}}function Ue(e,t){return function(r){if(r.value){if(e.disableVertexAttribArray(t),4!==r.value.length)throw new Error("The length of an unsigned integer constant value must be 4!");e.vertexAttrib4uiv(t,r.value)}else e.bindBuffer(e.ARRAY_BUFFER,r.buffer),e.enableVertexAttribArray(t),e.vertexAttribIPointer(t,r.numComponents||r.size,r.type||e.UNSIGNED_INT,r.stride||0,r.offset||0),void 0!==r.divisor&&e.vertexAttribDivisor(t,r.divisor)}}function Se(e,t,r){const n=r.size,o=r.count;return function(r){e.bindBuffer(e.ARRAY_BUFFER,r.buffer);const i=r.size||r.numComponents||n,a=i/o,s=r.type||e.FLOAT,u=he[s].size*i,l=r.normalize||!1,c=r.offset||0,f=u/o;for(let n=0;n<o;++n)e.enableVertexAttribArray(t+n),e.vertexAttribPointer(t+n,a,s,l,u,c+f*n),void 0!==r.divisor&&e.vertexAttribDivisor(t+n,r.divisor)}}he[5126]={Type:Float32Array,size:4,setter:function(e,t){return function(r){e.uniform1f(t,r)}},arraySetter:function(e,t){return function(r){e.uniform1fv(t,r)}}},he[35664]={Type:Float32Array,size:8,setter:function(e,t){return function(r){e.uniform2fv(t,r)}}},he[35665]={Type:Float32Array,size:12,setter:function(e,t){return function(r){e.uniform3fv(t,r)}}},he[35666]={Type:Float32Array,size:16,setter:function(e,t){return function(r){e.uniform4fv(t,r)}}},he[5124]={Type:Int32Array,size:4,setter:Te,arraySetter:Ae},he[35667]={Type:Int32Array,size:8,setter:Re},he[35668]={Type:Int32Array,size:12,setter:ge},he[35669]={Type:Int32Array,size:16,setter:xe},he[5125]={Type:Uint32Array,size:4,setter:function(e,t){return function(r){e.uniform1ui(t,r)}},arraySetter:function(e,t){return function(r){e.uniform1uiv(t,r)}}},he[36294]={Type:Uint32Array,size:8,setter:function(e,t){return function(r){e.uniform2uiv(t,r)}}},he[36295]={Type:Uint32Array,size:12,setter:function(e,t){return function(r){e.uniform3uiv(t,r)}}},he[36296]={Type:Uint32Array,size:16,setter:function(e,t){return function(r){e.uniform4uiv(t,r)}}},he[35670]={Type:Uint32Array,size:4,setter:Te,arraySetter:Ae},he[35671]={Type:Uint32Array,size:8,setter:Re},he[35672]={Type:Uint32Array,size:12,setter:ge},he[35673]={Type:Uint32Array,size:16,setter:xe},he[35674]={Type:Float32Array,size:16,setter:function(e,t){return function(r){e.uniformMatrix2fv(t,!1,r)}}},he[35675]={Type:Float32Array,size:36,setter:function(e,t){return function(r){e.uniformMatrix3fv(t,!1,r)}}},he[35676]={Type:Float32Array,size:64,setter:function(e,t){return function(r){e.uniformMatrix4fv(t,!1,r)}}},he[35685]={Type:Float32Array,size:24,setter:function(e,t){return function(r){e.uniformMatrix2x3fv(t,!1,r)}}},he[35686]={Type:Float32Array,size:32,setter:function(e,t){return function(r){e.uniformMatrix2x4fv(t,!1,r)}}},he[35687]={Type:Float32Array,size:24,setter:function(e,t){return function(r){e.uniformMatrix3x2fv(t,!1,r)}}},he[35688]={Type:Float32Array,size:48,setter:function(e,t){return function(r){e.uniformMatrix3x4fv(t,!1,r)}}},he[35689]={Type:Float32Array,size:32,setter:function(e,t){return function(r){e.uniformMatrix4x2fv(t,!1,r)}}},he[35690]={Type:Float32Array,size:48,setter:function(e,t){return function(r){e.uniformMatrix4x3fv(t,!1,r)}}},he[35678]={Type:null,size:0,setter:ve,arraySetter:Fe,bindPoint:3553},he[35680]={Type:null,size:0,setter:ve,arraySetter:Fe,bindPoint:34067},he[35679]={Type:null,size:0,setter:ve,arraySetter:Fe,bindPoint:32879},he[35682]={Type:null,size:0,setter:ve,arraySetter:Fe,bindPoint:3553},he[36289]={Type:null,size:0,setter:ve,arraySetter:Fe,bindPoint:35866},he[36292]={Type:null,size:0,setter:ve,arraySetter:Fe,bindPoint:35866},he[36293]={Type:null,size:0,setter:ve,arraySetter:Fe,bindPoint:34067},he[36298]={Type:null,size:0,setter:ve,arraySetter:Fe,bindPoint:3553},he[36299]={Type:null,size:0,setter:ve,arraySetter:Fe,bindPoint:32879},he[36300]={Type:null,size:0,setter:ve,arraySetter:Fe,bindPoint:34067},he[36303]={Type:null,size:0,setter:ve,arraySetter:Fe,bindPoint:35866},he[36306]={Type:null,size:0,setter:ve,arraySetter:Fe,bindPoint:3553},he[36307]={Type:null,size:0,setter:ve,arraySetter:Fe,bindPoint:32879},he[36308]={Type:null,size:0,setter:ve,arraySetter:Fe,bindPoint:34067},he[36311]={Type:null,size:0,setter:ve,arraySetter:Fe,bindPoint:35866};const Ie={};Ie[5126]={size:4,setter:Pe},Ie[35664]={size:8,setter:Pe},Ie[35665]={size:12,setter:Pe},Ie[35666]={size:16,setter:Pe},Ie[5124]={size:4,setter:we},Ie[35667]={size:8,setter:we},Ie[35668]={size:12,setter:we},Ie[35669]={size:16,setter:we},Ie[5125]={size:4,setter:Ue},Ie[36294]={size:8,setter:Ue},Ie[36295]={size:12,setter:Ue},Ie[36296]={size:16,setter:Ue},Ie[35670]={size:4,setter:we},Ie[35671]={size:8,setter:we},Ie[35672]={size:12,setter:we},Ie[35673]={size:16,setter:we},Ie[35674]={size:4,setter:Se,count:2},Ie[35675]={size:9,setter:Se,count:3},Ie[35676]={size:16,setter:Se,count:4};const Be=/^[ \t]*\n/;function Le(e,t,r,n){const o=n||be,i=e.createShader(r);let a=0;if(Be.test(t)&&(a=1,t=t.replace(Be,"")),e.shaderSource(i,t),e.compileShader(i),!e.getShaderParameter(i,e.COMPILE_STATUS)){const r=e.getShaderInfoLog(i);return o(function(e,t){return t=t||0,++t,e.split("\n").map(function(e,r){return r+t+": "+e}).join("\n")}(t,a)+"\n*** Error compiling shader: "+r),e.deleteShader(i),null}return i}function Me(e,t,r){let n;if("function"==typeof t&&(r=t,t=void 0),"function"==typeof e)r=e,e=void 0;else if(e&&!Array.isArray(e)){if(e.errorCallback)return e;const t=e;r=t.errorCallback,e=t.attribLocations,n=t.transformFeedbackVaryings}const o={errorCallback:r||be,transformFeedbackVaryings:n};if(e){let r={};Array.isArray(e)?e.forEach(function(e,n){r[e]=t?t[n]:n}):r=e,o.attribLocations=r}return o}const Ce=["VERTEX_SHADER","FRAGMENT_SHADER"];function Ne(e,t){return t.indexOf("frag")>=0?e.FRAGMENT_SHADER:t.indexOf("vert")>=0?e.VERTEX_SHADER:void 0}function ke(e,t){t.forEach(function(t){e.deleteShader(t)})}function Oe(e,t,r,n,o){const i=Me(r,n,o),a=[];for(let r=0;r<t.length;++r){const n=Le(e,t[r],e[Ce[r]],i.errorCallback);if(!n)return null;a.push(n)}return function(e,t,r,n,o){const i=Me(r,n,o),a=[],s=[];for(let r=0;r<t.length;++r){let n=t[r];if("string"==typeof n){const t=ye(n),o=t?t.text:n;let a=e[Ce[r]];t&&t.type&&(a=Ne(e,t.type)||a),n=Le(e,o,a,i.errorCallback),s.push(n)}u=n,"undefined"!=typeof WebGLShader&&u instanceof WebGLShader&&a.push(n)}var u;if(a.length!==t.length)return i.errorCallback("not enough shaders for program"),ke(e,s),null;const l=e.createProgram();a.forEach(function(t){e.attachShader(l,t)}),i.attribLocations&&Object.keys(i.attribLocations).forEach(function(t){e.bindAttribLocation(l,i.attribLocations[t],t)});let c=i.transformFeedbackVaryings;if(c&&(c.attribs&&(c=c.attribs),Array.isArray(c)||(c=Object.keys(c)),e.transformFeedbackVaryings(l,c,i.transformFeedbackMode||e.SEPARATE_ATTRIBS)),e.linkProgram(l),!e.getProgramParameter(l,e.LINK_STATUS)){const t=e.getProgramInfoLog(l);return i.errorCallback("Error in program linking:"+t),e.deleteProgram(l),ke(e,s),null}return l}(e,a,i)}function De(e){const t=e.name;return t.startsWith("gl_")||t.startsWith("webgl_")}function Ge(e,t){const r={program:t,uniformSetters:function(e,t){let r=0;function n(t,n){const o=e.getUniformLocation(t,n.name),i=n.size>1&&"[0]"===n.name.substr(-3),a=n.type,s=he[a];if(!s)throw new Error(`unknown type: 0x${a.toString(16)}`);let u;if(s.bindPoint){const t=r;r+=n.size,u=i?s.arraySetter(e,a,t,o,n.size):s.setter(e,a,t,o,n.size)}else u=s.arraySetter&&i?s.arraySetter(e,o):s.setter(e,o);return u.location=o,u}const o={},i=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let r=0;r<i;++r){const i=e.getActiveUniform(t,r);if(De(i))continue;let a=i.name;"[0]"===a.substr(-3)&&(a=a.substr(0,a.length-3));const s=n(t,i);o[a]=s}return o}(e,t),attribSetters:function(e,t){const r={},n=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let o=0;o<n;++o){const n=e.getActiveAttrib(t,o);if(De(n))continue;const i=e.getAttribLocation(t,n.name),a=Ie[n.type],s=a.setter(e,i,a);s.location=i,r[n.name]=s}return r}(e,t)};return O(e)&&(r.uniformBlockSpec=function(e,t){const r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),n=[],o=[];for(let i=0;i<r;++i){o.push(i),n.push({});const r=e.getActiveUniform(t,i);if(De(r))break;n[i].name=r.name}[["UNIFORM_TYPE","type"],["UNIFORM_SIZE","size"],["UNIFORM_BLOCK_INDEX","blockNdx"],["UNIFORM_OFFSET","offset"]].forEach(function(r){const i=r[0],a=r[1];e.getActiveUniforms(t,o,e[i]).forEach(function(e,t){n[t][a]=e})});const i={},a=e.getProgramParameter(t,e.ACTIVE_UNIFORM_BLOCKS);for(let r=0;r<a;++r){const n=e.getActiveUniformBlockName(t,r),o={index:r,usedByVertexShader:e.getActiveUniformBlockParameter(t,r,e.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER),usedByFragmentShader:e.getActiveUniformBlockParameter(t,r,e.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER),size:e.getActiveUniformBlockParameter(t,r,e.UNIFORM_BLOCK_DATA_SIZE),uniformIndices:e.getActiveUniformBlockParameter(t,r,e.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES)};o.used=o.usedByVertexShader||o.usedByFragmentShader,i[n]=o}return{blockSpecs:i,uniformData:n}}(e,t),r.transformFeedbackInfo=function(e,t){const r={},n=e.getProgramParameter(t,e.TRANSFORM_FEEDBACK_VARYINGS);for(let o=0;o<n;++o){const n=e.getTransformFeedbackVarying(t,o);r[n.name]={index:o,type:n.type,size:n.size}}return r}(e,t)),r}const ze=36064,Xe=[{format:6408,type:5121,min:9729,wrap:33071},{format:34041}],We={};We[34041]=33306,We[6401]=36128,We[36168]=36128,We[6402]=36096,We[33189]=36096;const Ye={};function Ke(e,t,r,n){const o=e.FRAMEBUFFER,i=e.createFramebuffer();e.bindFramebuffer(o,i),r=r||e.drawingBufferWidth,n=n||e.drawingBufferHeight;let a=0;const s={framebuffer:i,attachments:[],width:r,height:n};return(t=t||Xe).forEach(function(t){let i=t.attachment;const u=t.format;let l=function(e){return We[e]}(u);if(l||(l=ze+a++),!i)if(function(e){return Ye[e]}(u))i=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,i),e.renderbufferStorage(e.RENDERBUFFER,u,r,n);else{const o=Object.assign({},t);o.width=r,o.height=n,void 0===o.auto&&(o.auto=!1,o.min=o.min||o.minMag||e.LINEAR,o.mag=o.mag||o.minMag||e.LINEAR,o.wrapS=o.wrapS||o.wrap||e.CLAMP_TO_EDGE,o.wrapT=o.wrapT||o.wrap||e.CLAMP_TO_EDGE),i=Ee(e,o)}if(c=i,"undefined"!=typeof WebGLRenderbuffer&&c instanceof WebGLRenderbuffer)e.framebufferRenderbuffer(o,l,e.RENDERBUFFER,i);else{if(!P(0,i))throw new Error("unknown attachment type");void 0!==t.layer?e.framebufferTextureLayer(o,l,i,t.level||0,t.layer):e.framebufferTexture2D(o,l,t.texTarget||e.TEXTURE_2D,i,t.level||0)}var c;s.attachments.push(i)}),s}Ye[32854]=!0,Ye[32855]=!0,Ye[36194]=!0,Ye[34041]=!0,Ye[33189]=!0,Ye[6401]=!0,Ye[36168]=!0;const He=/^(.*?)_/;function Ve(e,t){D(e,0);const r=e.getExtension(t);if(r){const n={},o=He.exec(t)[1],i="_"+o;for(const t in r){const a=r[t],s="function"==typeof a,u=s?o:i;let l=t;t.endsWith(u)&&(l=t.substring(0,t.length-u.length)),void 0!==e[l]?s||e[l]===a||F(l,e[l],a,t):s?e[l]=function(e){return function(){return e.apply(r,arguments)}}(a):(e[l]=a,n[l]=a)}n.constructor={name:r.constructor.name},D(n,0)}return r}const $e=["ANGLE_instanced_arrays","EXT_blend_minmax","EXT_color_buffer_float","EXT_color_buffer_half_float","EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2","EXT_frag_depth","EXT_sRGB","EXT_shader_texture_lod","EXT_texture_filter_anisotropic","OES_element_index_uint","OES_standard_derivatives","OES_texture_float","OES_texture_float_linear","OES_texture_half_float","OES_texture_half_float_linear","OES_vertex_array_object","WEBGL_color_buffer_float","WEBGL_compressed_texture_atc","WEBGL_compressed_texture_etc1","WEBGL_compressed_texture_pvrtc","WEBGL_compressed_texture_s3tc","WEBGL_compressed_texture_s3tc_srgb","WEBGL_depth_texture","WEBGL_draw_buffers"];const je=200,qe=200,Je=a([.1,.2,1]),Ze=[50,50,30],Qe=32;let et,tt,rt;const nt={position:[-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0]};let ot;function it(t,r,i){return e(this,void 0,void 0,function*(){if(et=document.getElementById("c"),tt=et.getContext("webgl2"),ot||(ot=function(){const e=document.createElement("canvas").getContext("2d");let t=["Music by Ashley Thorpe (The Soundsmith)","無限の都市","Добро пожаловать в Омск","एक असीम शहर","Design&code by @baturinsky","Thanks to Procjam Discord","Written in GLSL (mostly)","A Boundless City"];e.canvas.width=1024,e.canvas.height=512,e.fillStyle="white",e.font="bold 48px Verdana",e.scale(.85,1);for(let r=0;r<8;r++)e.fillText(t[r%8],0,64*(.5+r)),e.scale(1,1);let r=e.canvas;return Ee(tt,{src:r,wrap:tt.REPEAT})}()),!tt)return void(document.children[0].innerHTML="This browser has no WebGL2 support or it is not turned on.");!function(e){for(let t=0;t<$e.length;++t)Ve(e,$e[t])}(tt);const e=["noise-f","city-v","city-f","sky-f","simple-geo-v","star-f","raymarch-f","lattice-v","geo-f","quad-v","light-f","screen-f"],a=yield Promise.all(e.map(e=>{let t=document.getElementById(`${e}.glsl`);return t?t.innerHTML:document.getElementById(`${e}.glsl`)||function(e,t="text"){return new Promise(r=>{let n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType=t,n.onload=(()=>r(n.response)),n.send()})}(`./shaders/${e}.glsl`)})),[u,l,c,E,b,y,h,_,T,A,R,g]=(a.reduce((t,r,n)=>(t[e[n]]=r,t),{}),a),x=[et.clientWidth*i,et.clientHeight*i],v=st(tt,x,{internalFormat:tt.DEPTH24_STENCIL8}),F=st(tt,x,{internalFormat:tt.RGBA,min:tt.NEAREST}),P=(st(tt,x,{internalFormat:tt.RGBA16F}),st(tt,x,{internalFormat:tt.RGBA32F}),st(tt,x,{internalFormat:tt.RGBA16F,min:i>1?tt.LINEAR:tt.NEAREST}));rt||(rt=function(e){let t=qe*qe*qe,r=Math.ceil(Math.sqrt(t));const n={programs:e,source:k(tt,nt),uniforms:{u_resolution:qe,u_side:r},target:Ke(tt,[{internalFormat:tt.R32F}],r,r)};tt.drawBuffers([tt.COLOR_ATTACHMENT0]),at(tt,n),tt.flush();const o=new Float32Array(r*r);return tt.readBuffer(tt.COLOR_ATTACHMENT0),tt.readPixels(0,0,r,r,tt.RED,tt.FLOAT,o),Ee(tt,{target:tt.TEXTURE_3D,width:qe,height:qe,depth:qe,wrap:tt.MIRRORED_REPEAT,minMag:tt.LINEAR,internalFormat:tt.R16F,src:o.slice(0,t)})}([A,u]));const w=Ke(tt,[{attachment:F},{format:tt.DEPTH_STENCIL,attachment:v}],x[0],x[1]);tt.drawBuffers([tt.COLOR_ATTACHMENT0]),tt.enable(tt.DEPTH_TEST);const U={programs:[A,E],source:k(tt,nt),target:w};[...new Array(6)].map((e,t)=>0),nt.position.map(e=>200*e);const S={programs:[l,c],source:k(tt,{numElements:Ze[0]*Ze[1]*Ze[2]*6*6*3}),target:w},I={programs:[A,R],uniforms:{u_everything:F,u_depth:v},source:k(tt,nt),target:Ke(tt,[{attachment:P}],x[0],x[1])};tt.drawBuffers([tt.COLOR_ATTACHMENT0]);const B={programs:[A,g],uniforms:{u_color:I.target.attachments[0],u_bufferSize:x},source:k(tt,nt)};!function(e,t){t=t||1,t=Math.max(0,t);const r=e.clientWidth*t|0,n=e.clientHeight*t|0;(e.width!==r||e.height!==n)&&(e.width=r,e.height=n)}(et),tt.viewport(0,0,et.clientWidth,et.clientHeight);let L,M=new Int32Array(100);return L=((e,i,a,u,l,c,E,b)=>{const y=function(e,t,r,n,o){o=o||new s(16);const i=1/Math.tan(.5*e),a=1/(r-n);return o[0]=i/t,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=i,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=(r+n)*a,o[11]=-1,o[12]=0,o[13]=0,o[14]=r*n*a*2,o[15]=0,o}(40*Math.PI/180,et.clientWidth/et.clientHeight,5,2e3);let h=[0,0,1],_=p(i,n(i,a),h);const T=m(d(y,m(p([0,0,0],a,h)))),A=m(_),R=d(y,A),g=m(R),v=function(e){return(e=e||new s(16))[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}();M.fill(0,0);for(let e=0;e<u.length;e++){let t=Math.floor(e/16);u[e]&&(M[t]=M[t]+(1<<e%16))}let F=n(i,o(a,15*Qe)).map((e,t)=>Math.floor(e/Qe-Ze[t]/2));const P={"u_light[0].pos":[1300,1e3,2e3],"u_light[0].color":[1,1,1,5],u_ambient:[1,1,1,.1],u_specular:[1,1,1,1],u_shininess:10,u_time:e,u_orbRadius:1+.2*Math.sin(3*e),u_eye:i,u_origin:F,u_toSun:Je,u_resolution:je,u_scale:100,u_depthRange:[5,2e3],u_bufferSize:x,u_camera:_,u_inverseCamera:A,u_near:5,u_far:2e3,u_a:2005/1995,u_b:2e4/1995,u_world:v,u_citySize:Ze,u_blockSize:Qe,u_worldInverseTranspose:f(m(v)),u_worldViewProjection:R,u_inverseWorldViewProjection:g,u_raycastProjection:T,u_collected:M,u_noise:rt,u_checkpoint:l,u_previousCheckpoint:c,u_text:ot,u_musicTime:E};Object.assign(I.uniforms,P),S.uniforms=P,U.uniforms=P,at(tt,S),at(tt,I);const w=new Float32Array(4);tt.readBuffer(tt.COLOR_ATTACHMENT0),tt.readPixels(0,0,1,1,tt.RGBA,tt.FLOAT,w),w[2]?t():w[0]&&r(w[0]),at(tt,B)})})}function at(e,t){!function(e,t,r){r=r||e.FRAMEBUFFER,t?(e.bindFramebuffer(r,t.framebuffer),e.viewport(0,0,t.width,t.height)):(e.bindFramebuffer(r,null),e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight))}(e,t.target),t.overwrite||e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),t.programInfo||(t.programInfo=function(e,t,r,n,o){const i=Me(r,n,o);let a=!0;if(t=t.map(function(e){if(e.indexOf("\n")<0){const t=ye(e);t?e=t.text:(i.errorCallback("no element with id: "+e),a=!1)}return e}),!a)return null;const s=Oe(e,t,i);return s?Ge(e,s):null}(e,t.programs,e=>console.log(e)));const r=t.programInfo;e.useProgram(r.program),function(e,t,r){r.vertexArrayObject?e.bindVertexArray(r.vertexArrayObject):(function(e,t){for(const r in t){const n=e[r];n&&n(t[r])}}(t.attribSetters||t,r.attribs),r.indices&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r.indices))}(e,r,t.source),function e(t,r){const n=t.uniformSetters||t,o=arguments.length;for(let t=1;t<o;++t){const r=arguments[t];if(Array.isArray(r)){const t=r.length;for(let o=0;o<t;++o)e(n,r[o])}else for(const e in r){const t=n[e];t&&t(r[e])}}}(r,t.uniforms),function(e,t,r,n,o,i){r=void 0===r?e.TRIANGLES:r;const a=t.indices,s=t.elementType,u=void 0===n?t.numElements:n;o=void 0===o?0:o,s||a?void 0!==i?e.drawElementsInstanced(r,u,void 0===s?e.UNSIGNED_SHORT:t.elementType,o,i):e.drawElements(r,u,void 0===s?e.UNSIGNED_SHORT:t.elementType,o):void 0!==i?e.drawArraysInstanced(r,o,u,i):e.drawArrays(r,o,u)}(e,t.source),t.then&&t.then()}function st(e,t,r){return Ee(e,Object.assign({width:t[0],height:t[1]},r))}class ut{constructor(e){this.interval=100,this.pressed={},this.subs=[],e.addEventListener("keydown",this),e.addEventListener("keyup",this),e.addEventListener("mousedown",this),e.addEventListener("mouseup",this)}handleEvent(e){let t,r;e instanceof KeyboardEvent?(t=e.code,r="keydown"==e.type?"down":"up"):(t="Click"+e.button,r="mousedown"==e.type?"down":"up"),"down"==r&&(t in this.pressed||(this.click(t),this.pressed[t]=window.setInterval(()=>this.click(t),this.interval))),"up"==r&&(window.clearInterval(this.pressed[t]),delete this.pressed[t])}click(e){for(let t of this.subs)t(e)}sub(e){this.subs.push(e)}unsub(e){this.subs=this.subs.filter(t=>t!=e)}once(e){let t=r=>{this.unsub(t),e(r)};this.sub(t)}isPressed(e){return e in this.pressed}clear(){this.subs=[]}}let lt,ct,ft=1,mt={playerExplode:[1,.1,0,.8,.05,.7,4.6,21.2,.4],explode:[3,.1,1811,.8,.01,1.9,3,.5,.04],powerup:[1,.1,240,.2,.85,5.7,.8,0,.77],shieldDest:[1,.1,1750,.7,.05,.1,1.8,.3,.18],blast:[1,.1,5e3,1.7,.01,0,4,0,.45],ponk:[.5,.1,1549,.1,0,0,1.2,48.9,.17],boom:[1,.1,3e3,1.5,.01,0,4,0,.48],rumble:[1,.1,200,.7,.1,0,5,.1,.36],sad:[1,.1,264,1.1,.53,0,0,.1,.94],vwom:[1,.1,1,1,.11,0,0,69.2,.95],pop:[1,.1,21,.1,.46,9,.1,5.7,.12],swipe:[1,.1,866,.1,.5,0,1.6,.4,.98],ow:[1,.1,1682,.2,.66,3,0,1.2,.69],wave:[1,.1,1825,1,.2,0,5,.2,.3],bobbleUp:[1,.1,17,1,.26,.2,.1,8,.66]};function dt(e){lt||(lt=function(){let e=new AudioContext;return(t,r,n,o=1,i=.1,a=0,s=0,u=0,l=0)=>{let c=44100,f=Math.PI;n*=2*f/c,n*=1+r*(2*Math.random()-1),a*=1e3*f/c**2,i*=0|(o=0<o?c*(10<o?10:o)|0:1),u*=2*f/c,l*=f,r=[];for(var m=0,d=0,p=0;p<o;++p)r[p]=.5*t*Math.cos(m*n*Math.cos(d*u+l))*(p<i?p/i:1-(p-i)/(o-i)),m+=1+s*(2*Math.random()-1),d+=1+s*(2*Math.random()-1),n+=a;return t=e.createBuffer(1,o,c),n=e.createBufferSource(),t.getChannelData(0).set(r),n.buffer=t,n.connect(e.destination),n.start(),n}}()),lt(mt[e][0]*ft,...mt[e].slice(1))}const pt=[["brake",[10]],["boosts",[100,200,300,400,500]],["boostMore",[100,200,300,400,500]],["clasterFaster",[100,200,500,1e3,2e3]],["rewind",[100,300,500]],["rewindCheckpoint",[1e3]],["pickup",[500]],["friction",[100,200,500,1e3,2e3]],["time",[100,200,500,1e3,2e3]]],Et={brake:"Brake on <b>right mouse click</b>",boosts:"You can accelerate with <b>left mouse click</b> up to {0/1/2/3/4/5} times per checkpoint.",boostMore:"You gain {0/25/50/75/100/125} more velocity when accelerating.",clasterFaster:"You gain {0/25/50/75/100/125} more velocity when collecting a cluster.",rewind:"You rewind back to previous checkpoint up to {0/1/2/3} times when crashing.",rewindCheckpoint:"You get 1 more rewind when reaching a checkpoint.",pickup:"You can collect checkpoint from a longer distance",friction:"Air friction is reduced by {0/10%/20%/30%/40%/50%}",time:"Time limit for reaching checkpoint is increased by {0/10%/20%/30%/40%/50%}"},bt=Math.PI/180,yt=300,ht=.3,_t=.03,Tt=10,At=10;let Rt,gt=0,xt=0,vt=[1,0,0],Ft=[0,0],Pt=60,wt=localStorage.boundlessCity,Ut=wt?JSON.parse(wt):{upgrades:{},coins:100,mute:!1};function St(e=0){localStorage.boundlessCity=JSON.stringify({upgrades:It,mute:Lt,coins:Bt+e})}let It=Ut.upgrades,Bt=Ut.coins,Lt=!!Ut.mute;function Mt(){return Rt={pos:[0,0,0],vel:50,time:0,rot:[0,0],smoothRot:[0,0]},{time:0,timeLeft:40*(1+.1*(It.time||0)),collected:new Uint8Array(1e3),thisRunCoins:0,boosts:It.boosts||0,lives:(It.rewind||0)+1,previousCheckpoint:{pos:[0,0,0],vel:50,time:0,rot:[0,0],smoothRot:[0,0]},checkpoint:[20,0,-3],checkpoints:0,over:0,state:Rt}}let Ct=Mt();function Nt(e){return pt.find(t=>t[0]==e)[1][It[e]||0]||1e9}function kt(){return document.pointerLockElement==et&&!zt()}const Ot=1,Dt=2,Gt=["","You have crashed into something solid. Or something solid has crashed into you.","You have run out of time. You remember that <span style='color:#0f0'>checkpoints</span> extend time, right?"];function zt(){return Ct.over}function Xt(){dt("bobbleUp"),Ct.lives>1?(Ct.lives--,Ht()):Wt(Ot)}function Wt(e){Ct.over=e,Bt+=Ct.thisRunCoins,St(),jt(),Vt()}function Yt(e){Ct.collected[e]||(dt("ponk"),Ct.thisRunCoins+=Ct.checkpoints+1,Rt.vel+=Tt*(1+.25*(It.clasterFaster||0)),e>=0&&(Ct.collected[e]=1),St(Ct.thisRunCoins))}function Kt(){var e,r;Ct.previousCheckpoint=JSON.parse(JSON.stringify(Rt)),Ct.previousCheckpoint.pos=(e=Ct.checkpoint,(r=r||new t(3))[0]=e[0],r[1]=e[1],r[2]=e[2],r).map(e=>e*Qe),console.log(Ct.previousCheckpoint)}function Ht(){Object.assign(Rt,JSON.parse(JSON.stringify(Ct.previousCheckpoint))),Rt.vel=Math.min(Rt.vel,30),Ct.boosts=It.boosts||0,Ft=[0,0]}function Vt(){document.exitPointerLock()}function $t(){dt("powerup"),Ct.checkpoints++,Ct.boosts=It.boosts||0,It.rewindCheckpoint&&(Ct.lives=Math.min(Ct.lives+1,(It.rewind||0)+1)),Ct.timeLeft+=20*(1+.1*(It.time||0));let e=(t=gt+(r=Ct.checkpoint,Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2])),(t%=2147483647)<=0&&(t+=2147483646),()=>t=16807*t%2147483647);var t,r;Kt();let o=a([vt[0],vt[1],0]),i=[e(),e(),e()].map((e,t)=>Math.floor(e%1500/100-10+(2==t?-3+Ct.checkpoints:30*o[t]))*(1+.2*Ct.checkpoints));Ct.checkpoint=n(i,Ct.checkpoint).map(e=>Math.floor(e))}function jt(){ct.innerHTML="\n  <div>Level</div><div>Cost</div><div> </div><div>Upgrade</div>\n  "+pt.map(e=>`<div>${It[e[0]]||0}/${e[1].length}</div><div>${e[1][It[e[0]]||0]||"MAX"}</div>      \n    <button ${Nt(e[0])>Bt?"disabled":""} onclick="buy('${e[0]}')">Buy!</button>\n    <div style="text-align: left;">${function(e,t){return e=e.replace(/\{(.*)\}/,e=>{let r=e.substr(1,e.length-2).split("/");return r[t]='<b style="color:white">'+r[t]+"</b>",'<span style="color:#bbb">'+r.join("/")+"</span>"})}(Et[e[0]],It[e[0]]||0)}</div>`).join("")+`<div>Coins:</div><div class="coin">${Bt}</div>\n  `}let qt,Jt,Zt=0;window.onload=(r=>e(void 0,void 0,void 0,function*(){let r=yield it(Xt,Yt,2),i=yield it(Xt,Yt,1),s=r,u=document.getElementById("stats"),l=document.getElementById("orbs"),c=document.getElementById("pause"),f=document.getElementById("win");function m(){Ct=Mt(),p(),E()}ct=document.getElementById("upgrades"),window.buy=(e=>{Bt-=Nt(e),It[e]=(It[e]||0)+1,St(),jt()}),window.restartGame=(()=>m());const d=new ut(document);function p(){s(Rt.time,Rt.pos,vt,Ct.collected,Ct.checkpoint,Ct.previousCheckpoint.pos.map(e=>e/Qe),Jt?Jt.context.currentTime:0,.001*Zt)}function E(){qt||(qt=window.requestAnimationFrame(b))}function b(e){if(qt=0,c.style.visibility=kt()||zt()?"hidden":"visible",gt++,f.style.visibility=zt()?"visible":"hidden",zt())return void(f.innerHTML=`<h2>Run complete</h2> ${Gt[Ct.over]} <br/> You have collected <b>${Ct.thisRunCoins}</b> coins in <b>${Math.floor(Rt.time)} seconds!</b><br/><br/> <button onclick="restartGame()"><b>R</b>estart</button>`);if(!kt()&&gt>1)return void E();let r=(e-xt)/1e3;if(r>.1&&(r=.1),Pt=.99*Pt+.01/r,xt=e,Rt.time+=r,Ct.timeLeft-=r,Ct.timeLeft<=0)return Wt(Dt),void E();Ft=Ft.map(e=>Math.sign(e)*Math.min(30,Math.abs(e)*r*60)),Rt.rot[0]=Rt.rot[0]-.1*Ft[0],Rt.rot[1]=Math.max(-89.999,Math.min(89.999,Rt.rot[1]-.1*Ft[1]));let i=Math.min(1,30*r);Rt.smoothRot=Rt.smoothRot.map((e,t)=>e*(1-i)+Rt.rot[t]*i);let[s,m]=Rt.smoothRot.map(e=>e*bt);if(vt=a([Math.cos(m)*Math.cos(s),Math.cos(m)*Math.sin(s),Math.sin(m)]),Zt+=Ft[0],Zt*=1-10*r,Ft=[0,0],d.pressed.KeyO&&(Rt.vel+=yt*r),d.pressed.KeyL&&(Rt.vel=Math.max(0,Rt.vel-yt*r)),Rt.vel*=1-_t*(1-.1*(It.friction||0))*r,Rt.vel<=At){let e=At-Rt.vel/100;Rt.pos[2]-=e*ht,Rt.vel+=e}let b=o(vt,Rt.vel*r);var y,h,_;Rt.vel-=b[2]*ht,Rt.pos=n(Rt.pos,b),gt%5==0&&(u.innerText=`Time: ${Math.floor(Rt.time)} Position: ${Rt.pos.map(e=>Math.round(e)).join(",")} Velocity: ${Math.floor(Rt.vel)} FPS: ${Math.round(Pt)}`,l.innerHTML=`        \n      <div>Coins: <span class="coin">${Ct.thisRunCoins}</span></div>\n      <div>Mult.: <b>${Ct.checkpoints+1}</b></div>\n      <div>Lives: <b style="color:#0f0">${Ct.lives}</b></div>\n      <div>Boosts: <b style="color:#f00">${Ct.boosts}</b></div>\n      <div>Time: <b style="color:#8ff">${Math.floor(Ct.timeLeft)}</b></div>\n      `),function(e,t){const r=e[0]-t[0],n=e[1]-t[1],o=e[2]-t[2];return Math.sqrt(r*r+n*n+o*o)}(Ct.checkpoint,(y=Rt.pos,h=Qe,(_=_||new t(3))[0]=y[0]/h,_[1]=y[1]/h,_[2]=y[2]/h,_))<1*(1+2*(It.pickup||0))&&$t(),p(),E()}document.addEventListener("keydown",e=>{"Space"==e.code&&(kt()?Vt():et.requestPointerLock()),"KeyR"!=e.code?("KeyN"==e.code&&e.shiftKey&&(m(),Bt=100,It={},jt(),St()),"KeyP"!=e.code?"KeyQ"!=e.code?"KeyM"==e.code&&(Lt=!Lt,Jt&&(Lt?Jt.context.suspend():Jt.context.resume(),St())):s=s==r?i:r:Ht()):m()}),et.addEventListener("mousedown",t=>e(void 0,void 0,void 0,function*(){Jt||(Jt=yield function(t){return e(this,void 0,void 0,function*(){const e=new Audio(t);e.loop=!0;const r=new window.AudioContext,n=r.createMediaElementSource(e),o=r.createGain();return o.gain.setValueAtTime(1,0),n.connect(o),o.connect(r.destination),e.play(),{context:r,gain:o}})}("Boundless_City_v2.mp3"),Lt&&Jt.context.suspend()),kt()?(0==t.button&&Ct.boosts>0&&(Ct.boosts--,Rt.vel+=30*(1+.25*(It.boostMore||0))),2==t.button&&It.brake&&(Rt.vel=Math.max(Rt.vel-30,2*At))):et.requestPointerLock()})),et.addEventListener("mousemove",e=>{Ft[0]+=e.movementX,Ft[1]+=e.movementY}),m(),Vt(),jt(),E()}))}();
